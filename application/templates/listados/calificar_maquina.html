{% extends 'base.html' %}
{% block styles %}
.btn-volver {
    position: absolute;
    top: 20px;
    left: 20px;
    display: inline-block;
    background-color: #b95a33;
    color: white;
    padding: 0.8rem 1.5rem;
    border-radius: 0.6rem;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.btn-volver:hover {
    background-color: #666;
    transform: translateY(-2px);
    color: white;
    text-decoration: none;
}

.calificar-box {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 1rem;
    margin: 2rem auto;
    max-width: 1200px;
}
.btn-primary {
    display: inline-block;
    background-color: #d16c44 !important;  
    color: white !important;               
    padding: 0.7rem 1.2rem;
    border-radius: 0.6rem;
    text-decoration: none;
    font-weight: 600;
    margin-bottom: 1.5rem;
    transition: background-color 0.3s ease;
    border: none !important;               
}

.btn-primary:hover {
    background-color: #b85a38 !important; 
    color: white !important;               
    text-decoration: none;
}
.calificar-box h2, .calificar-box label {
    color: white;
}

.calificar-box .form-control {
   font-size: 1.1rem;
   width: 100%;
   border-radius: 0.8rem;
}

.alert-info {
    background-color: #ff8d85;
    border-color: #17a2b8;
    color: #0c5460;
}

.calificar-box .form-control {
    font-size: 1.1rem;
    width: 100%;
    border-radius: 0.8rem;
    transition: background-color 0.3s ease;
}

.calificar-box .form-control:hover {
    background-color: #666;
}

.btn-secondary {
    display: inline-block;
    background-color: #6c757d;
    color: white;
    padding: 0.7rem 1.2rem;
    border-radius: 0.6rem;
    text-decoration: none;
    font-weight: 600;
    transition: background-color 0.3s ease;
    border: none;
}

.btn-secondary:hover {
    background-color: #545b62;
    color: white;
    text-decoration: none;
}

/* Para que los botones estén alineados */
.d-flex .btn {
    margin-bottom: 0;
}

.calificar-box textarea {
    border-radius: 0.8rem !important;
    border: 1px solid #ced4da;
    padding: 0.75rem;
    font-size: 1.1rem;
    width: 100% !important;
    resize: vertical; /* Solo permite redimensionar verticalmente */
    min-height: 120px; /* Altura mínima */
}

.calificar-box textarea:focus {
    border-color: #d16c44;
    box-shadow: 0 0 0 0.2rem rgba(209, 108, 68, 0.25);
    outline: none;
}
/* Mensajes de error unificados */
.text-danger, .invalid-feedback {
    background-color: rgba(220, 53, 69, 0.2) !important;
    border: 1px solid rgba(220, 53, 69, 0.3) !important;
    color: #fff !important;
    padding: 0.75rem 1rem !important;
    border-radius: 0.5rem !important;
    margin-top: 0.5rem !important;
    display: block !important;
    max-width: 75% 
}

.text-danger::before, .invalid-feedback::before {

    margin-right: 0.5rem;
}
{% endblock %}
{% load static %}
{% block content %}
<a href="javascript:history.back()" class="btn-volver">
                <i class="fas fa-arrow-left"></i> Volver a la página anterior
            </a>
<div class="container mt-5">
    <div class="calificar-box">

        
        <h2>Calificar {{ maquina.nombre }}</h2>
        
        {% if calificacion_existente %}
            <div class="alert alert-info mb-4">
                Ya has calificado esta máquina. Puedes modificar tu calificación si lo deseas.
            </div>
        {% endif %}

        <form method="post">
            {% csrf_token %}
            
            <div class="form-group mb-3">
                <label>Calificación:</label>
                <div class="rating-stars">
                    {% for value, label in form.estrellas.field.choices %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="estrellas" 
                                   value="{{ value }}" id="star{{ value }}"
                                   {% if form.estrellas.value|stringformat:"i" == value|stringformat:"i" %}checked{% endif %}>
                            <label class="form-check-label" for="star{{ value }}">
                                {% for i in "12345"|make_list %}
                                    {% if forloop.counter <= value %}
                                        <i class="fas fa-star"></i> 
                                    {% endif %}
                                {% endfor %}
                            </label>
                        </div>
                    {% endfor %}
                </div>
                {% if form.estrellas.errors %}
                    <div class="text-danger">
                        {{ form.estrellas.errors }}
                    </div>
                {% endif %}
            </div>
             <label for="{{ form.comentario.id_for_label }}">Comentario:</label>
            <div class="form-group mb-3">
                {{ form.comentario }}
                {% if form.comentario.errors %}
                    <div class="text-danger">
                        {{ form.comentario.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="d-flex justify-content-between">
                <a href="{% url 'detalle_maquinaria' maquina.id %}" class="btn btn-secondary">Cancelar</a>
                <button type="submit" class="btn btn-primary">
                    {% if calificacion_existente %}
                        Actualizar calificación
                    {% else %}
                        Enviar calificación
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %} 